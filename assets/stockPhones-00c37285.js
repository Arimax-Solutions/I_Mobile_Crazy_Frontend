import{r as a,j as t}from"./index-22430338.js";import{T as se}from"./topNavbar-8a7575ae.js";import{C as Q}from"./combobox-9c5f6775.js";import{B as T}from"./buttons-138cfeed.js";import{S as s}from"./sweetalert2.all-bcf0cdbb.js";import{a as m}from"./axios-dd1c8fc2.js";import{b as u}from"./utill-834e5e31.js";function ue(){const F=new Date().toISOString().split("T")[0],[x,h]=a.useState(""),[b,p]=a.useState(""),[i,f]=a.useState(""),[y,g]=a.useState(""),[C,v]=a.useState(""),[I,j]=a.useState(""),[E,N]=a.useState(""),[w,S]=a.useState(""),[O,B]=a.useState(""),[k,U]=a.useState(""),[A,$]=a.useState([]),[l,K]=a.useState(null),[D,H]=a.useState([]),[P,M]=a.useState([]),[Z,L]=a.useState(!1),R=[{value:"Gold",label:"Gold"},{value:"White",label:"White"}],V=[{value:"64GB",label:"64GB"},{value:"128GB",label:"128GB"},{value:"256GB",label:"256GB"},{value:"512GB",label:"512GB"},{value:"1TB",label:"1TB"}],z=e=>/^[a-zA-Z\s]*$/.test(e),G=(e,r)=>/^\d+$/.test(e.toString())&&e<=r,d=(e,r,o,c,re)=>{e(o),r(o,c)||s.fire({icon:"error",title:"Invalid Input",text:re})};a.useEffect(()=>{q()},[]);const n={stockName:/^[a-zA-Z\s]+$/,description:/^[a-zA-Z\s]+$/,quantity:/^\d+$/,model:/^[a-zA-Z0-9\s]+$/,imeiNumber:/^\d{15}$/,storage:/^(64GB|128GB|256GB|512GB|1TB)$/,iosversion:/^\d+$/,batteryHealth:/^\d+$/,colour:/^(Gold|White)$/},W=()=>n.stockName.test(x)?n.description.test(b)?!n.quantity.test(i)||parseInt(i,10)>500?(s.fire({title:"Error!",text:"Quantity is invalid. It must be a number and cannot exceed 500.",icon:"error",confirmButtonText:"OK"}),!1):n.model.test(y)?n.imeiNumber.test(C)?n.storage.test(I)?n.iosversion.test(E)?!n.batteryHealth.test(w)||parseInt(w,10)>100?(s.fire({title:"Error!",text:"Battery Health is invalid. It must be a number and cannot exceed 100.",icon:"error",confirmButtonText:"OK"}),!1):n.colour.test(O)?!0:(s.fire({title:"Error!",text:"Colour is invalid. Choose a valid option.",icon:"error",confirmButtonText:"OK"}),!1):(s.fire({title:"Error!",text:"iOS Version is invalid. It must be a number.",icon:"error",confirmButtonText:"OK"}),!1):(s.fire({title:"Error!",text:"Storage is invalid. Choose a valid option.",icon:"error",confirmButtonText:"OK"}),!1):(s.fire({title:"Error!",text:"IMEI Number is invalid. It must be exactly 15 digits.",icon:"error",confirmButtonText:"OK"}),!1):(s.fire({title:"Error!",text:"Model is invalid. Only alphanumeric characters and spaces are allowed.",icon:"error",confirmButtonText:"OK"}),!1):(s.fire({title:"Error!",text:"Description is invalid. Only letters and spaces are allowed.",icon:"error",confirmButtonText:"OK"}),!1):(s.fire({title:"Error!",text:"Stock name is invalid. Only letters and spaces are allowed.",icon:"error",confirmButtonText:"OK"}),!1),q=async()=>{const e=localStorage.getItem("authToken");if(e){U(e);try{const r=await m.get(`${u}/api/stock`,{headers:{Authorization:`Bearer ${e}`}});console.log(r.data),r.data&&Array.isArray(r.data.data)?$(r.data.data):console.error("Invalid data format received from server:",r.data)}catch(r){console.error("Error fetching items:",r)}}else console.log("No token found")},Y=()=>{console.log(y.length);const e=parseInt(i,10);if(P.length>=e){s.fire({icon:"error",title:"Stock Limit Exceeded",text:"You cannot add more models than the available stock quantity."});return}if(!W())return;const r={name:y,stockAddedDate:F,imeiNumbers:[{imei:C,storage:I,colour:O,iosversion:E,batteryHealth:w}]};console.log("newPhoneModel:",r);const o=[...D,r],c=[...P,r];H(o),M(c),console.log("updatedPhoneModels:",o),console.log("updatedModelsTable:",c),g(""),v(""),j(""),B(""),N(""),S("")},J=async()=>{const e={name:x,description:b,qty:parseInt(i),models:D};try{const r=await m.post(`${u}/api/stock`,e,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${k}`}});r.status===201&&(s.fire({title:"Success!",text:"Phone added successfully",icon:"success",confirmButtonText:"OK"}),setTimeout(()=>{window.location.reload()},4e3),$([...A,r.data.data]),h(""),p(""),f(""),H([]),M([]))}catch(r){console.error("Error adding phone:",r),s.fire({title:"Error!",text:"Failed to add phone",icon:"error",confirmButtonText:"OK"})}},_=async()=>{if(!l)return;const e={id:l.id,name:x,qty:parseInt(i),description:b,models:D};console.log("Updating phone with data:",JSON.stringify(e,null,2));try{(await m.put(`${u}/api/stock/${l.id}`,e,{headers:{Authorization:`Bearer ${k}`,"Content-Type":"application/json"}})).status===200?(s.fire("Success","Phone updated successfully","success"),q(),setTimeout(()=>{window.location.reload()},4e3)):s.fire("Error","Failed to update phone","error")}catch(r){console.error("Failed to update phone:",r),s.fire("Error","An error occurred while updating the phone","error")}},X=async e=>{if(l)try{const r=await m.delete(`${u}/api/stock/${e}`,{headers:{Authorization:`Bearer ${k}`}});console.log(r);const o=A.filter(c=>c.id!==e);$(o),K(null),s.fire({title:"Success!",text:"Phone deleted successfully",icon:"success",confirmButtonText:"OK"}),setTimeout(()=>{window.location.reload()},4e3),h(""),p(""),f(""),g(""),v(""),j(""),N(""),S(""),B("")}catch(r){console.error("Error deleting phone:",r),s.fire({title:"Error!",text:"Failed to delete phone",icon:"error",confirmButtonText:"OK"})}},ee=async e=>{K(e),h(e.name),p(e.description),f(e.qty.toString()),L(!0);try{const r=await m.get(`${u}/api/stock/models/${e.id}`,{headers:{Authorization:`Bearer ${k}`}});Array.isArray(r.data)?M(r.data):console.error("Invalid data format received from server:",r.data)}catch(r){console.error("Error fetching phone models:",r)}},te=e=>{if(g(e.name),e.imeiNumbers.length>0){const r=e.imeiNumbers[0];v(r.imei),j(r.storage),B(r.colour),N(r.iosversion),S(r.batteryHealth)}};return t.jsxs("div",{className:"m-4 w-full",children:[t.jsx("div",{className:"m-4",children:t.jsx(se,{})}),t.jsxs("div",{className:"m-4 text-white font-semibold",children:[t.jsxs("div",{className:"mt-5 flex flex-col sm:flex-row justify-between",children:[t.jsx("input",{className:"text-feild mb-4 md:mb-0 md:w-[30%] lg:mx-2 md:mx-2 sm:mx-1",value:x,onChange:e=>d(h,z,e.target.value,null,"Stock name must be a string"),placeholder:"   Stock Name"}),t.jsx("input",{className:"text-feild mb-4 md:mb-0 md:w-[30%] lg:mx-2 md:mx-2 sm:mx-1",value:b,onChange:e=>d(p,z,e.target.value,null,"Description must be a string"),placeholder:"   Description"}),t.jsx("input",{className:"text-feild mb-4 md:mb-0 md:w-[30%] lg:mx-2 md:mx-2 sm:mx-1",value:i,onChange:e=>d(f,G,e.target.value,500,"Quantity cannot exceed 500"),placeholder:"   Quantity"})]}),t.jsxs("div",{className:"mt-3 flex flex-col sm:flex-row justify-between ",children:[t.jsx("input",{className:"text-feild mb-4 md:mb-0 md:w-[30%] lg:mx-2 md:mx-2 sm:mx-1",value:y,onChange:e=>g(e.target.value),placeholder:"   Model"}),t.jsx("input",{className:"text-feild mb-4 md:mb-0 md:w-[30%] lg:mx-2 md:mx-2 sm:mx-1",value:C,onChange:e=>v(e.target.value),placeholder:"   IMEI Number"}),t.jsx(Q,{value:I,onChange:e=>j(e.target.value),options:V,placeholder:"Storage"})]}),t.jsxs("div",{className:"mt-3 flex flex-col sm:flex-row justify-between",children:[t.jsx("input",{className:"text-feild mb-4 md:mb-0 md:w-[30%] lg:mx-2 md:mx-2 sm:mx-1",value:E,onChange:e=>d(N,G,e.target.value,50,"iOS version must be a number"),placeholder:"   IOS Version"}),t.jsx("input",{className:"text-feild mb-4 md:mb-0 md:w-[30%] lg:mx-2 md:mx-2 sm:mx-1",value:w,onChange:e=>d(S,G,e.target.value,100,"Battery health cannot exceed 100"),placeholder:"   Battery Health"}),t.jsx(Q,{value:O,onChange:e=>B(e.target.value),options:R,placeholder:"Colour"})]})]}),t.jsxs("div",{className:"m-4 mt-5 text-white",style:{height:"35vh",overflowY:"auto"},children:[t.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Phone Models"}),t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"min-w-full bg-gray-800 text-white",children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{className:"py-2 px-4 border-b border-gray-700",children:"ID"})," ",t.jsx("th",{className:"py-2 px-4 border-b border-gray-700",children:"Model Name"}),t.jsx("th",{className:"py-2 px-4 border-b border-gray-700",children:"Stock Added Date"}),t.jsx("th",{className:"py-2 px-4 border-b border-gray-700",children:"IMEI Number"}),t.jsx("th",{className:"py-2 px-4 border-b border-gray-700",children:"Storage"}),t.jsx("th",{className:"py-2 px-4 border-b border-gray-700",children:"iOS Version"}),t.jsx("th",{className:"py-2 px-4 border-b border-gray-700",children:"Battery Health"}),t.jsx("th",{className:"py-2 px-4 border-b border-gray-700",children:"Colour"})]})}),t.jsx("tbody",{children:P.map((e,r)=>e?t.jsxs("tr",{onClick:()=>te(e),children:[t.jsx("td",{className:"py-2 px-4 border-b border-gray-700",children:r+1})," ",t.jsx("td",{className:"py-2 px-4 border-b border-gray-700",children:e.name}),t.jsx("td",{className:"py-2 px-4 border-b border-gray-700",children:e.stockAddedDate}),t.jsx("td",{className:"py-2 px-4 border-b border-gray-700",children:e.imeiNumbers.map(o=>o.imei).join(", ")}),t.jsx("td",{className:"py-2 px-4 border-b border-gray-700",children:e.imeiNumbers.map(o=>o.storage).join(", ")}),t.jsx("td",{className:"py-2 px-4 border-b border-gray-700",children:e.imeiNumbers.map(o=>o.iosversion).join(", ")}),t.jsx("td",{className:"py-2 px-4 border-b border-gray-700",children:e.imeiNumbers.map(o=>o.batteryHealth).join(", ")}),t.jsx("td",{className:"py-2 px-4 border-b border-gray-700",children:e.imeiNumbers.map(o=>o.colour).join(", ")})]},r):t.jsx("tr",{},r))})]})})]}),t.jsxs("div",{className:"m-4 flex mt-5 gap-x-[3vw] justify-end",children:[t.jsx(T,{onClick:Y,className:"buttons-styles bg-green-button w-full sm:w-[20%] md:w-[15%] lg:w-[15%] xl:w-[10vw] h-[5vh] text-center rounded-xl flex justify-center items-center",iconSrc:"src/assets/icons/Add Btn.svg",iconAlt:"add icon",children:"ADD"}),t.jsx(T,{onClick:()=>X((l==null?void 0:l.id)||0),className:"buttons-styles bg-red-button w-full sm:w-[20%] md:w-[15%] lg:w-[15%] xl:w-[10vw] h-[5vh] text-center rounded-xl flex justify-center items-center",iconSrc:"src/assets/icons/Delete Btn.svg",iconAlt:"delete icon",children:"DELETE"}),t.jsx(T,{onClick:_,className:"buttons-styles bg-blue-button w-full sm:w-[20%] md:w-[15%] lg:w-[15%] xl:w-[10vw] h-[5vh] text-center rounded-xl flex justify-center items-center",iconSrc:"src/assets/icons/Update Btn.svg",iconAlt:"update icon",children:"UPDATE"}),t.jsx(T,{onClick:J,className:`buttons-styles bg-green-button w-full sm:w-[20%] md:w-[15%] lg:w-[15%] xl:w-[10vw] h-[5vh] text-center rounded-xl flex justify-center items-center ${Z?"hidden":""}`,iconSrc:"src/assets/icons/Add Btn.svg",iconAlt:"add icon",children:"PUSH"})]}),t.jsxs("div",{className:"m-4 mt-5 text-white",children:[t.jsx("h2",{className:"text-xl font-semibold mb-4",children:"List of Stocks"}),t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"min-w-full bg-gray-800 text-white table-styles",children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{className:"py-2 px-4 border-b border-gray-700",children:"ID"}),t.jsx("th",{className:"py-2 px-4 border-b border-gray-700",children:"Name"}),t.jsx("th",{className:"py-2 px-4 border-b border-gray-700",children:"Description"}),t.jsx("th",{className:"py-2 px-4 border-b border-gray-700",children:"Quantity"})]})}),t.jsx("tbody",{children:A.map((e,r)=>t.jsxs("tr",{onClick:()=>ee(e),className:"cursor-pointer hover:bg-gray-700",children:[t.jsx("td",{className:"py-2 px-4 border-b border-gray-700",children:e.id}),t.jsx("td",{className:"py-2 px-4 border-b border-gray-700",children:e.name}),t.jsx("td",{className:"py-2 px-4 border-b border-gray-700",children:e.description}),t.jsx("td",{className:"py-2 px-4 border-b border-gray-700",children:e.qty})]},e.id||r))})]})})]})]})}export{ue as default};
